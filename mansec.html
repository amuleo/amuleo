<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>همراه لئو: مروری بر چالش‌ها و راهکارها</title>
    <meta name="robots" content="noindex, nofollow">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        /* استایل‌های پایه برای بدنه صفحه */
        body {
            font-family: 'Vazirmatn', 'Tahoma', sans-serif;
            background-color: #f8fafc; /* bg-slate-50 */
            color: #334155; /* text-slate-700 */
            /* انیمیشن نرم برای تغییر رنگ‌ها هنگام تغییر تم */
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* استایل‌های بدنه در حالت تم تاریک */
        body.dark {
            background-color: #1e293b; /* معادل slate-800 */
            color: #f8fafc; /* معادل slate-50 */
        }

        /* استایل دکمه‌های تب */
        .tab-button {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
            text-align: center; /* متن دکمه را وسط‌چین می‌کند */
            white-space: nowrap; /* از شکستن خط متن دکمه جلوگیری می‌کند */
        }

        /* استایل دکمه تب فعال */
        .tab-button.active {
            border-color: #10b981; /* emerald-500 */
            color: #059669; /* emerald-600 */
            font-weight: 700;
        }

        /* استایل دکمه تب فعال در حالت تاریک */
        body.dark .tab-button.active {
            border-color: #10b981; /* emerald-500 */
            color: #059669; /* emerald-600 */
        }

        /* استایل دکمه تب هنگام هاور شدن */
        .tab-button:hover {
            color: #059669; /* emerald-600 */
        }

        /* استایل دکمه تب هنگام هاور شدن در حالت تاریک */
        body.dark .tab-button:hover {
            color: #059669; /* emerald-600 */
        }

        /* استایل محتوای تب‌ها */
        .tab-content {
            display: none; /* به صورت پیش‌فرض مخفی است */
            padding: 1.5rem;
            border: 1px solid #e2e8f0; /* slate-300 */
            border-top: none; /* حاشیه بالا ندارد */
            border-radius: 0 0 0.5rem 0.5rem;
            background-color: white;
        }

        /* استایل محتوای تب‌ها در حالت تاریک */
        body.dark .tab-content {
            background-color: #334155; /* معادل slate-700 */
            color: #e2e8f0; /* معادل slate-300 */
            border-color: #475569; /* معادل slate-600 */
        }

        /* استایل محتوای تب فعال */
        .tab-content.active {
            display: block; /* نمایش محتوای تب فعال */
        }

        /* استایل دکمه‌های آکاردئون */
        .accordion-button {
            background-color: #f1f5f9; /* slate-100 */
            color: #1e293b; /* slate-800 */
            cursor: pointer;
            padding: 1rem;
            width: 100%; /* تمام عرض را می‌گیرد */
            text-align: right;
            border: none;
            outline: none;
            transition: background-color 0.3s ease;
            font-weight: 500;
            border-radius: 0.375rem;
            display: flex; /* برای قرار دادن آیکون در سمت چپ */
            justify-content: space-between; /* آیکون را به سمت چپ می‌برد */
            align-items: center;
        }

        /* استایل دکمه‌های آکاردئون در حالت تاریک */
        body.dark .accordion-button {
            background-color: #334155; /* معادل slate-700 */
            color: #f8fafc; /* معادل slate-50 */
        }

        /* استایل دکمه‌های آکاردئون هنگام هاور شدن یا فعال بودن */
        .accordion-button:hover, .accordion-button.active {
            background-color: #e2e8f0; /* slate-200 */
        }

        /* استایل دکمه‌های آکاردئون هنگام هاور شدن یا فعال بودن در حالت تاریک */
        body.dark .accordion-button:hover, body.dark .accordion-button.active {
            background-color: #334155; /* معادل slate-700 */
        }

        /* استایل محتوای آکاردئون */
        .accordion-content {
            padding: 0 1rem;
            background-color: white;
            max-height: 0; /* به صورت پیش‌فرض مخفی است */
            overflow: hidden;
            /* انیمیشن برای باز و بسته شدن */
            transition: max-height 0.3s ease-out, padding 0.3s ease-out, margin-bottom 0.3s ease-out; /* اضافه کردن margin-bottom به transition */
            border-right: 2px solid #10b981; /* emerald-500 */
            margin-right: 0.5rem;
            margin-bottom: 0; /* به صورت پیش‌فرض 0 */
        }

        /* استایل محتوای آکاردئون در حالت تاریک */
        body.dark .accordion-content {
            background-color: #334155; /* معادل slate-700 */
            color: #e2e8f0; /* معادل slate-300 */
            border-right-color: #10b981; /* emerald-500 */
        }

        /* استایل محتوای آکاردئون فعال */
        .accordion-content.active {
            /* max-height توسط JS تنظیم می‌شود */
            padding-top: 1rem;
            padding-bottom: 1rem; /* بازگشت به padding اصلی */
            margin-bottom: 5px; /* این فاصله بین پنل آکاردئون باز شده و عنصر بعدی است */
        }

        /* استایل عنوان‌های بخش‌ها */
        .section-title {
            font-size: 1.5rem; /* text-2xl */
            font-weight: 700; /* font-bold */
            color: #1e293b; /* slate-800 */
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #10b981; /* emerald-500 */
        }

        /* استایل عنوان‌های بخش‌ها در حالت تاریک */
        body.dark .section-title {
            color: #f8fafc; /* معادل slate-50 */
            border-bottom-color: #10b981; /* emerald-500 */
        }

        /* استایل عنوان‌های زیربخش‌ها */
        .sub-section-title {
            font-size: 1.25rem; /* text-xl */
            font-weight: 600; /* font-semibold */
            color: #334155; /* slate-700 */
            margin-top: 1.5rem;
            margin-bottom: 0.75rem;
        }

        /* استایل عنوان‌های زیربخش‌ها در حالت تاریک */
        body.dark .sub-section-title {
            color: #e2e8f0; /* معادل slate-300 */
        }

        /* استایل لیست‌ها */
        ul {
            list-style-type: disc;
            padding-right: 2rem; /* padding برای راست به چپ */
            margin-bottom: 1rem;
        }

        /* استایل آیتم‌های لیست */
        li {
            margin-bottom: 0.5rem;
            line-height: 1.75;
            text-align: justify;
        }

        /* استایل پاراگراف‌ها */
        p {
            line-height: 1.75;
            margin-bottom: 1rem;
            text-align: justify; /* پاراگراف‌ها جاستیفای می‌شوند */
        }

        /* استایل متن‌های بولد */
        strong {
            font-weight: 700;
            color: #059669; /* emerald-600 */
        }

        /* استایل متن‌های بولد در حالت تاریک */
        body.dark strong {
            color: #059669; /* emerald-600 */
        }

        /* استایل‌های سفارشی برای اسکرول بار نازک (1px) */
        /* برای مرورگرهای Webkit (کروم، سافاری) */
        .tab-nav-scroll::-webkit-scrollbar {
            height: 1px; /* ارتفاع اسکرول بار افقی */
        }

        .tab-nav-scroll::-webkit-scrollbar-track {
            background: transparent; /* پس‌زمینه اسکرول بار */
        }

        .tab-nav-scroll::-webkit-scrollbar-thumb {
            background-color: #a0aec0; /* رنگ اسکرول بار در حالت روشن (slate-400) */
            border-radius: 0.5px; /* گردی اسکرول بار (نصف ارتفاع) */
        }

        /* رنگ اسکرول بار در حالت تاریک */
        body.dark .tab-nav-scroll::-webkit-scrollbar-thumb {
            background-color: #64748b; /* رنگ اسکرول بار در حالت تاریک (slate-600) */
        }

        /* برای مرورگرهای Firefox */
        .tab-nav-scroll {
            scrollbar-width: thin; /* عرض اسکرول بار (Firefox) */
            scrollbar-color: #a0aec0 transparent; /* رنگ thumb و track برای فایرفاکس */
        }

        /* رنگ اسکرول بار در فایرفاکس در حالت تاریک */
        body.dark .tab-nav-scroll {
            scrollbar-color: #64748b transparent; /* رنگ thumb و track برای فایرفاکس در حالت تاریک */
        }

        /* استایل‌های سفارشی برای دکمه ورود و پروگرس بار و اسپینر */
        #login-button {
            position: relative;
            overflow: hidden; /* برای قرارگیری صحیح پروگرس بار و اسپینر */
            display: flex; /* برای مرکزیت محتوا */
            align-items: center;
            justify-content: center;
        }

        #login-button-text {
            opacity: 1; /* ابتدا قابل مشاهده است */
            transition: opacity 0.3s ease; /* انیمیشن محو شدن متن */
            position: relative; /* برای اطمینان از قرارگیری صحیح روی اسپینر */
            z-index: 2; /* بالاتر از پروگرس بار و اسپینر */
        }

        #login-progress-bar {
            position: absolute;
            left: 0;
            bottom: 0;
            height: 2px;
            width: 100%;
            background-color: #10b981; /* رنگ پروگرس بار */
            transform: scaleX(0); /* ابتدا مخفی است */
            transform-origin: left; /* از چپ رشد می‌کند */
            transition: transform 0.3s ease, background-color 0.3s ease; /* انیمیشن رشد و تغییر رنگ */
            z-index: 1; /* زیر متن و اسپینر */
        }

        #login-spinner {
            position: absolute;
            inset: 0; /* کل فضای دکمه را پوشش می‌دهد */
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0; /* ابتدا مخفی است */
            transition: opacity 0.3s ease; /* انیمیشن ظاهر شدن/محو شدن اسپینر */
            z-index: 2; /* هم سطح با متن، برای جایگزینی بصری */
            pointer-events: none; /* اجازه می‌دهد کلیک‌ها از طریق آن عبور کنند وقتی مخفی است */
        }

        /* انیمیشن چرخش اسپینر */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        #login-spinner::after {
            content: '';
            width: 20px; /* اندازه اسپینر */
            height: 20px; /* اندازه اسپینر */
            border: 2px solid #fff; /* رنگ اسپینر (سفید) */
            border-top-color: transparent; /* قسمت بالای شفاف برای ایجاد جلوه چرخش */
            border-radius: 50%; /* دایره‌ای کردن */
            animation: spin 0.8s linear infinite; /* انیمیشن چرخش */
        }

        /* وضعیت دکمه هنگام لودینگ */
        #login-button.loading #login-button-text {
            opacity: 0; /* محو شدن متن */
        }

        #login-button.loading #login-progress-bar {
            transform: scaleX(1); /* نمایش پروگرس بار */
        }

        #login-button.loading #login-spinner {
            opacity: 1; /* نمایش اسپینر */
        }

        /* وضعیت دکمه هنگام خطا */
        #login-button.error #login-progress-bar {
            background-color: #ef4444; /* تغییر رنگ پروگرس بار به قرمز */
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8 flex items-center justify-center">

    <div id="login-screen" class="bg-white shadow-xl rounded-lg p-8 max-w-sm w-full text-center
                                 dark:bg-slate-700 dark:shadow-none">
        <h2 class="text-2xl font-bold mb-6 text-slate-800 dark:text-slate-50">ورود به همراه لئو</h2>
        <input type="password" id="password-input" class="w-full p-3 mb-4 border border-slate-300 rounded-md
                                                        focus:outline-none focus:ring-2 focus:ring-emerald-500 text-center
                                                        dark:bg-slate-800 dark:border-slate-600 dark:text-slate-50
                                                        dark:focus:ring-emerald-500"
               placeholder="رمز عبور را وارد کنید">
        <button id="login-button" class="w-full bg-emerald-500 text-white p-3 rounded-md font-semibold
                                        hover:bg-emerald-600 transition duration-300
                                        dark:bg-emerald-500 dark:hover:bg-emerald-600">
            <span id="login-button-text">ورود</span>
            <div id="login-progress-bar"></div>
            <div id="login-spinner"></div>
        </button>
        <p id="error-message" class="text-red-500 mt-3 hidden dark:text-red-500">رمز عبور اشتباه است. لطفاً دوباره تلاش کنید.</p>
    </div>

    <div id="main-content" class="container mx-auto max-w-4xl bg-white shadow-xl rounded-lg hidden
                                 dark:bg-slate-700 dark:shadow-none">
        <header class="bg-emerald-500 text-white p-6 rounded-t-lg dark:bg-emerald-500">
            <h1 class="text-3xl font-bold text-center">همراه لئو: مروری بر چالش‌ها و راهکارها</h1>
        </header>

        <nav class="flex flex-nowrap border-b border-slate-300 bg-slate-50 rounded-t-none
                    dark:border-slate-600 dark:bg-slate-800 overflow-x-auto tab-nav-scroll">
            <button class="tab-button active" onclick="openTab(event, 'tab-intro')">معرفی لئو</button>
            <button class="tab-button" onclick="openTab(event, 'tab-challenges')">چالش‌ها</button>
            <button class="tab-button" onclick="openTab(event, 'tab-solutions')">راهکارها</button>
            <button class="tab-button" onclick="openTab(event, 'tab-conclusion')">جمع‌بندی</button>
            <button class="tab-button" onclick="openTab(event, 'tab-motivations')">تلنگر</button>
        </nav>

        <div id="tab-intro" class="tab-content active">
            <h2 class="section-title"></h2>
            <div></div>
        </div>

        <div id="tab-challenges" class="tab-content">
            <h2 class="section-title"></h2>
            <div></div>
        </div>

        <div id="tab-solutions" class="tab-content">
            <h2 class="section-title"></h2>
            <div></div>
        </div>

        <div id="tab-conclusion" class="tab-content">
            <h2 class="section-title"></h2>
            <div></div>
        </div>

        <div id="tab-motivations" class="tab-content">
            <h2 class="section-title"></h2>
            <div></div>
        </div>
    </div>

    <script>
        /* ------------------ جلوگیری از inspect ------------------ */
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });

        document.addEventListener('keydown', function(e) {
            // جلوگیری از کلید F12
            if (e.keyCode === 123) {
                e.preventDefault();
                return false;
            }
            // جلوگیری از ترکیب‌های Ctrl+Shift+I و Ctrl+Shift+J
            if (e.ctrlKey && e.shiftKey && (e.keyCode === 73 || e.keyCode === 74)) {
                e.preventDefault();
                return false;
            }
            // جلوگیری از Ctrl+U
            if (e.ctrlKey && e.keyCode === 85) {
                e.preventDefault();
                return false;
            }
        });
        /* ------------------ پایان جلوگیری از inspect ------------------ */


        // آدرس Worker برای احراز هویت (Worker اول)
        const AUTH_WORKER_URL = "https://pass.immohammaddavoodi.workers.dev/";
        // آدرس Worker برای دریافت محتوای تب‌ها (Worker دوم)
        const DATA_WORKER_URL = "https://decrypting.immohammaddavoodi.workers.dev/";

        // گرفتن ارجاع به عناصر DOM
        const passwordInput = document.getElementById("password-input");
        const loginButton = document.getElementById("login-button");
        const errorMessage = document.getElementById("error-message");
        const loginScreen = document.getElementById("login-screen");
        const mainContent = document.getElementById("main-content");

        // ارجاع به عناصر جدید برای انیمیشن پروگرس بار و اسپینر
        const loginButtonText = document.getElementById("login-button-text");
        const loginProgressBar = document.getElementById("login-progress-bar");
        const loginSpinner = document.getElementById("login-spinner"); // عنصر اسپینر

        let cachedTabData = null; // برای ذخیره داده‌های تب پس از بارگذاری اولیه

        /**
         * تابع برای مدیریت احراز هویت کاربر.
         * رمز عبور را به Worker اول ارسال کرده، کد ثانویه را دریافت و سپس داده‌های تب را از Worker دوم بارگذاری می‌کند.
         */
        async function authenticate() {
            const password = passwordInput.value;
            errorMessage.classList.add("hidden"); // مخفی کردن پیام خطا قبلی

            // نمایش پروگرس بار و اسپینر و مخفی کردن متن دکمه
            loginButton.classList.add('loading');
            loginButton.classList.remove('error'); // اطمینان از حذف کلاس خطا
            loginButton.disabled = true; // غیرفعال کردن دکمه در حین پردازش

            try {
                // مرحله 1: احراز هویت با Worker اول
                const authResponse = await fetch(AUTH_WORKER_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ password: password })
                });

                const authData = await authResponse.json();

                if (authData.success && authData.secondaryCode) {
                    // مرحله 2: دریافت داده‌های تب از Worker دوم با استفاده از کد ثانویه
                    const dataResponse = await fetch(DATA_WORKER_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ secondaryCode: authData.secondaryCode })
                    });

                    if (dataResponse.ok) {
                        cachedTabData = await dataResponse.json(); // ذخیره داده‌ها
                        populateTabs(cachedTabData); // پر کردن تب‌ها با داده‌های دریافتی

                        // مخفی کردن صفحه ورود و نمایش محتوای اصلی
                        loginScreen.classList.add("hidden");
                        mainContent.classList.remove("hidden");
                        // تغییر کلاس‌های body برای تنظیم مجدد طرح‌بندی پس از ورود
                        document.body.classList.remove("flex", "items-center", "justify-center");
                        document.body.classList.add("block");
                        // باز کردن تب معرفی لئو به عنوان تب اولیه
                        openTab(null, 'tab-intro');

                        // پس از موفقیت، پروگرس بار و اسپینر را مخفی کن و دکمه را فعال کن
                        loginButton.classList.remove('loading');
                        loginButton.disabled = false;
                    } else {
                        // اگر Worker دوم خطا داد (مثلاً کد ثانویه نامعتبر بود)
                        const errorText = await dataResponse.text();
                        errorMessage.textContent = `خطا در دریافت اطلاعات: ${errorText}`;
                        errorMessage.classList.remove("hidden");
                        console.error("Data Worker error:", dataResponse.status, errorText);

                        // نمایش حالت خطا و سپس بازگرداندن دکمه
                        loginButton.classList.add('error');
                        setTimeout(() => {
                            loginButton.classList.remove('loading', 'error');
                            loginButton.disabled = false;
                        }, 1500); // 1.5 ثانیه برای نمایش خطا
                    }

                } else {
                    // نمایش پیام خطا در صورت عدم موفقیت در ورود از Worker اول
                    errorMessage.textContent = authData.message || "رمز عبور اشتباه است. لطفاً دوباره تلاش کنید.";
                    errorMessage.classList.remove("hidden");
                    passwordInput.value = ""; // پاک کردن فیلد رمز عبور

                    // نمایش حالت خطا و سپس بازگرداندن دکمه
                    loginButton.classList.add('error');
                    setTimeout(() => {
                        loginButton.classList.remove('loading', 'error');
                        loginButton.disabled = false;
                    }, 1500); // 1.5 ثانیه برای نمایش خطا
                }
            } catch (error) {
                // مدیریت خطاهای شبکه یا سرور
                errorMessage.textContent = "خطا در اتصال به سرور. لطفاً بعداً امتحان کنید.";
                errorMessage.classList.remove("hidden");
                console.error("Authentication or Data Fetch error:", error);

                // نمایش حالت خطا و سپس بازگرداندن دکمه
                loginButton.classList.add('error');
                setTimeout(() => {
                    loginButton.classList.remove('loading', 'error');
                    loginButton.disabled = false;
                }, 1500); // 1.5 ثانیه برای نمایش خطا
            }
        }

        /**
         * تابع برای پر کردن محتوای تب‌ها با داده‌های دریافتی از Worker دوم.
         * @param {Object} data - آبجکت حاوی داده‌های تب‌ها.
         */
        function populateTabs(data) {
            for (const tabId in data) {
                if (data.hasOwnProperty(tabId)) {
                    const tabElement = document.getElementById(tabId);
                    if (tabElement) {
                        // پر کردن عنوان بخش
                        const sectionTitleElement = tabElement.querySelector('.section-title');
                        if (sectionTitleElement) {
                            sectionTitleElement.textContent = data[tabId].title;
                        }
                        // پر کردن محتوای اصلی تب
                        const contentContainer = tabElement.querySelector('div:not(.accordion-content)'); // محفظه اصلی محتوا
                        if (contentContainer) {
                            contentContainer.innerHTML = data[tabId].content;

                            // اگر تب solutions است، دکمه‌های آکاردئون را مجدداً مقداردهی کن
                            if (tabId === 'tab-solutions') {
                                initializeAccordions();
                            }
                        }
                    }
                }
            }
        }


        // افزودن شنونده رویداد برای دکمه ورود
        loginButton.addEventListener("click", authenticate);

        // افزودن شنونده رویداد برای کلید Enter در فیلد رمز عبور
        passwordInput.addEventListener("keypress", (event) => {
            if (event.key === "Enter") {
                authenticate();
            }
        });

        /**
         * تابع برای باز کردن تب‌های مختلف.
         * تمام تب‌ها را مخفی کرده و تب مورد نظر را نمایش می‌دهد.
         * @param {Event} event - رویداد کلیک (می‌تواند null باشد برای باز شدن اولیه)
         * @param {string} tabName - شناسه (ID) تب مورد نظر برای نمایش
         */
        function openTab(event, tabName) {
            // مخفی کردن تمام محتوای تب‌ها
            const tabcontent = document.getElementsByClassName("tab-content");
            for (let i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
                tabcontent[i].classList.remove("active");
            }

            // غیرفعال کردن تمام دکمه‌های تب
            const tabbuttons = document.getElementsByClassName("tab-button");
            for (let i = 0; i < tabbuttons.length; i++) {
                tabbuttons[i].classList.remove("active");
            }

            // نمایش تب مورد نظر
            document.getElementById(tabName).style.display = "block";
            document.getElementById(tabName).classList.add("active");

            // فعال کردن دکمه تب مربوطه
            if (event) { // اگر رویداد کلیک وجود دارد (یعنی کاربر روی دکمه کلیک کرده)
                event.currentTarget.classList.add("active");
            } else { // اگر رویداد null است (یعنی بارگذاری اولیه صفحه)
                // دکمه مربوط به تب فعال را پیدا کرده و فعال می‌کند
                const activeButton = document.querySelector(`.tab-button[onclick*="${tabName}"]`);
                if (activeButton) {
                    activeButton.classList.add('active');
                }
            }
        }

        /**
         * تابع برای مقداردهی اولیه (initialize) دکمه‌های آکاردئون.
         * این تابع باید پس از بارگذاری محتوای تب‌ها فراخوانی شود.
         */
        function initializeAccordions() {
            // گرفتن تمام دکمه‌های آکاردئون
            const accordionButtons = document.querySelectorAll('.accordion-button');
            // افزودن شنونده رویداد برای هر دکمه آکاردئون
            accordionButtons.forEach(button => {
                // اطمینان حاصل کنید که شنونده رویداد قبلاً اضافه نشده باشد تا از اضافه شدن چندباره جلوگیری شود
                // این کار را می‌توان با حذف شنونده قبلی یا استفاده از یک پرچم انجام داد.
                // برای سادگی در این مثال، فرض می‌کنیم که این تابع فقط یک بار پس از بارگذاری محتوا فراخوانی می‌شود.
                button.removeEventListener('click', handleAccordionClick); // حذف شنونده قبلی اگر وجود دارد
                button.addEventListener('click', handleAccordionClick); // اضافه کردن شنونده جدید
            });
        }

        /**
         * تابع کنترل‌کننده کلیک برای دکمه‌های آکاردئون.
         * @param {Event} event - رویداد کلیک.
         */
        function handleAccordionClick(event) {
            const button = event.currentTarget;
            const content = button.nextElementSibling; // محتوای آکاردئون
            const icon = button.querySelector('svg'); // آیکون SVG

            // تغییر وضعیت فعال/غیرفعال دکمه و آیکون
            button.classList.toggle('active');
            icon.classList.toggle('rotate-180'); // چرخش آیکون

            // باز و بسته کردن محتوای آکاردئون
            if (content.style.maxHeight && content.style.maxHeight !== '0px') { // اگر باز است
                // قبل از بستن، ارتفاع فعلی را برای انیمیشن صحیح تنظیم کن
                content.style.maxHeight = content.scrollHeight + 'px';
                void content.offsetWidth; // Force reflow
                content.style.maxHeight = '0px'; // بستن
                content.classList.remove('active');
            } else { // اگر بسته است
                content.classList.add('active'); // ابتدا کلاس active را اضافه کن تا پدینگ‌ها اعمال شوند
                content.style.maxHeight = 'none'; // موقتااً maxHeight را بردار تا scrollHeight دقیق محاسبه شود
                const scrollHeight = content.scrollHeight; // ارتفاع واقعی محتوا را بگیر
                content.style.maxHeight = '0px'; // به 0 برگردان برای شروع انیمیشن
                void content.offsetWidth; // یک reflow اجباری برای اطمینان از اعمال 0px قبل از تنظیم ارتفاع جدید
                content.style.maxHeight = scrollHeight + 'px'; // انیمیشن به ارتفاع واقعی

                // پس از اتمام انیمیشن، maxHeight را به 'none' تغییر بده تا محتوا بتواند به صورت پویا گسترش یابد
                content.addEventListener('transitionend', function handler() {
                    if (content.classList.contains('active')) { // فقط اگر هنوز فعال است (در طول انیمیشن بسته نشده)
                        content.style.maxHeight = 'none';
                    }
                    content.removeEventListener('transitionend', handler);
                });
            }
        }


        // منطق برای تشخیص و اعمال تم تاریک/روشن سیستم عامل
        // بررسی اولیه تم دستگاه هنگام بارگذاری صفحه
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.body.classList.add('dark'); // اگر تم دستگاه تاریک است، کلاس 'dark' را اضافه کن
        } else {
            document.body.classList.remove('dark'); // در غیر این صورت، مطمئن شو که کلاس 'dark' وجود ندارد
        }

        // گوش دادن به تغییرات تم دستگاه در زمان واقعی
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.body.classList.add('dark'); // اگر تم به تاریک تغییر کرد
            } else {
                document.body.classList.remove('dark'); // اگر تم به روشن تغییر کرد
            }
        });
    </script>
</body>
</html>
